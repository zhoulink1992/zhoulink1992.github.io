<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="SSM," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="经过前面两篇文章SSM的整合和一个案例带你快速入门SSM开发的讲解后，我们已经顺利的了解了利用SSM进行开发的基础知识，本篇文章将为你介绍更负责的高级知识，例如数据回显、参数绑定list数据、图片的上传、json数据的请求和响应、validation分组校验、统一异常处理、RESTful支持以及拦截器的应用。">
<meta property="og:type" content="article">
<meta property="og:title" content="SSM注解开发的高级知识讲解">
<meta property="og:url" content="http://codingxiaxw.cn/2016/11/19/46-ssm高级开发/index.html">
<meta property="og:site_name" content="codingXiaxw's blog">
<meta property="og:description" content="经过前面两篇文章SSM的整合和一个案例带你快速入门SSM开发的讲解后，我们已经顺利的了解了利用SSM进行开发的基础知识，本篇文章将为你介绍更负责的高级知识，例如数据回显、参数绑定list数据、图片的上传、json数据的请求和响应、validation分组校验、统一异常处理、RESTful支持以及拦截器的应用。">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.38.02.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.39.28.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.39.43.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.02.01.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.16.17.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.20.04.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.23.53.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.56.44.png">
<meta property="og:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%885.29.43.png">
<meta property="og:updated_time" content="2017-01-30T19:21:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SSM注解开发的高级知识讲解">
<meta name="twitter:description" content="经过前面两篇文章SSM的整合和一个案例带你快速入门SSM开发的讲解后，我们已经顺利的了解了利用SSM进行开发的基础知识，本篇文章将为你介绍更负责的高级知识，例如数据回显、参数绑定list数据、图片的上传、json数据的请求和响应、validation分组校验、统一异常处理、RESTful支持以及拦截器的应用。">
<meta name="twitter:image" content="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.38.02.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://codingxiaxw.cn/2016/11/19/46-ssm高级开发/"/>


  <title> SSM注解开发的高级知识讲解 | codingXiaxw's blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">codingXiaxw's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Life is short,just coding.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            Contact
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                SSM注解开发的高级知识讲解
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-19T14:49:31+08:00" content="Nov 19 2016">
              Nov 19 2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SSM/" itemprop="url" rel="index">
                    <span itemprop="name">SSM</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/19/46-ssm高级开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/46-ssm高级开发/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/11/19/46-ssm高级开发/" class="leancloud_visitors" data-flag-title="SSM注解开发的高级知识讲解">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>经过前面两篇文章<a href="http://codingxiaxw.cn/2016/11/15/45-smm%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">SSM的整合和一个案例带你快速入门SSM开发</a>的讲解后，我们已经顺利的了解了利用SSM进行开发的基础知识，本篇文章将为你介绍更负责的高级知识，例如数据回显、参数绑定list数据、图片的上传、json数据的请求和响应、validation分组校验、统一异常处理、RESTful支持以及拦截器的应用。</p>
<a id="more"></a>   
<p>当然此篇文章也是在前篇文章开发的工程基础上进行讲解。<a href="https://github.com/codingXiaxw/ssm2" target="_blank" rel="external">源码请点击这里前往我的github</a></p>
<h2 id="1-数据回显"><a href="#1-数据回显" class="headerlink" title="1.数据回显"></a>1.数据回显</h2><p>需求:当提交表单时出现错误，回到表单重新填写数据时需要将刚才提交的参数在页面回显。以往我们采用将数据放在request域中然后请求转发到表单页面，运用el表达式将数据回显。在springmvc中我们通过Model对象的addAttribute(“id”,id),将简单类型的数据传入request域(注意在进入修改页面的controller方法中和提交修改商品信息方法model.addAttribute方法设置的key一致)。通过Model的addAttribute(“pojo”,pojo)方法将pojo类型的数据也是传入到request域中，然后通过el表达式完成取出request域中的数据，这是pojo类型数据回显的第一种方法，如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/editItemSubmit"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">editItemSubmit</span><span class="params">(Model model,Integer id,ItemsCustom itemsCustom)</span> <span class="keyword">throws</span> Exception</span><br><span class="line"></span>&#123;</span><br><span class="line">   <span class="comment">//进行数据回显</span></span><br><span class="line">   model.addAttribute(<span class="string">"id"</span>,id);</span><br><span class="line">   model.addAttribute(<span class="string">"item"</span>,itemsCustom);</span><br><span class="line">   </span><br><span class="line">   itemsService.updateItems(id,itemsCustom);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">"editItem"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种方法是通过@ModelAttribute()注解的方式，括号内传入要回显的pojo对象，如我们这里要将itemsCustom传到request域所以我们这样写<code>@ModelAttribute(value=&quot;itemsCustom&quot;)</code>，然后便可以将代码中的将model添加到request域的代码<code>model.addAttribute(&quot;item&quot;,itemsCustom);</code>注释掉了。  </p>
<p><strong>@ModelAttribute()注解的另外一种用法:</strong>将方法的返回值填入到request域然后显示在页面上。在ItemsController.java中加入方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单独将商品类型的方法提取出来，将方法返回值填充到request域，在页面提示</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>(<span class="string">"itemsType"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">getItemsType</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String,String&gt; itemsType=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    itemsType.put(<span class="string">"001"</span>,<span class="string">"data type"</span>);</span><br><span class="line">    itemsType.put(<span class="string">"002"</span>,<span class="string">"clothes"</span>);</span><br><span class="line">    <span class="keyword">return</span> itemsType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后我们在itemsList.jsp页面中加入如下标签进行页面的展示:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;itemsType&#125;"</span> <span class="attr">var</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;item.key&#125;"</span>&gt;</span>$&#123;item.value&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>成功使用@ModleAttribute注解将方法返回值返回到页面。其实这种注解的方式也是将数据填入到request域中，然后在页面中通过el表达式取出，同model.addAttribute()方法和modelAndView.addObject()方法。  </p>
<p>使用@ModelAttribute将公用的取数据的方法返回值传到页面，不用在每一个controller方法通过Model将数据传到页面。</p>
<h2 id="2-将页面信息绑定到参数集合类型中"><a href="#2-将页面信息绑定到参数集合类型中" class="headerlink" title="2.将页面信息绑定到参数集合类型中"></a>2.将页面信息绑定到参数集合类型中</h2><p>前面的基础知识讲解中我们都只是将简单类型和pojo类型的数据绑定到了参数中。接下来讲解高级知识的绑定。  </p>
<h3 id="2-1将页面信息绑定到数组参数中"><a href="#2-1将页面信息绑定到数组参数中" class="headerlink" title="2.1将页面信息绑定到数组参数中"></a>2.1将页面信息绑定到数组参数中</h3><p>需求:在商品查询列表页面，用户选择要删除的商品，批量删除商品。  </p>
<p>在controller方法中如何将批量提交的数据绑定成数组类型。  </p>
<p>页面的定义,在itemsList.jsp中每件商品前面添加一个checkbox:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"delete_id"</span> <span class="attr">value</span>=<span class="string">"$&#123;item.id&#125;"</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在上方添加一个批量删除的按钮:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"批量删除"</span> <span class="attr">onclick</span>=<span class="string">"deleteItems()"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>因为我们form的action是点击查询后返回到itemsList.action，所以这里我们点击delete_id按钮应该返回到另一个action所以需要编写一个js脚本对该按钮进行事件监听。</p>
<p>以及点击这个按钮响应的事件:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">deleteItems</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//将form的action指向删除商品的地址</span></span><br><span class="line">		<span class="built_in">document</span>.itemsForm.action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/items/deleteItems.action"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//进行form提交</span></span><br><span class="line">		<span class="built_in">document</span>.itemsForm.submit();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后需要在contronller中添加deleteItems()方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除商品</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/deleteItems"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteItems</span><span class="params">(Integer[] delete_id)</span> <span class="keyword">throws</span> Exception</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//调用serive方法删除商品</span></span><br><span class="line">    <span class="comment">//这里我们就是简单的介绍完成将页面的信息绑定到数组中，所以service的方法你可以自己去完成</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后定义一个success.jsp页面输出成功删除的信息即可。</p>
<h3 id="2-2绑定页面信息到List中"><a href="#2-2绑定页面信息到List中" class="headerlink" title="2.2绑定页面信息到List中"></a>2.2绑定页面信息到List<object>中</object></h3><p>需求:批量修改商品信息提交。先进入批量修改商品页面，填写信息，点击提交。  </p>
<p>页面的定义,新建一个editItemsList.jsp页面，内容如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span>  <span class="attr">prefix</span>=<span class="string">"fmt"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>批量修改商品查询<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">		<span class="function"><span class="keyword">function</span> <span class="title">updateItems</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="comment">//将form的action指向删除商品的地址</span></span><br><span class="line">			<span class="built_in">document</span>.itemsForm.action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/items/deleteItems.action"</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//进行form提交</span></span><br><span class="line">			<span class="built_in">document</span>.itemsForm.submit();</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"itemsForm"</span> <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/items/queryItem.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">查询条件：</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">border</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;itemsType&#125;"</span> <span class="attr">var</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;item.key&#125;"</span>&gt;</span>$&#123;item.value&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"批量修改提交"</span> <span class="attr">onclick</span>=<span class="string">"updateItems()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">商品列表：</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">border</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>商品名称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>商品价格<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>生产日期<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>商品描述<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;itemsList &#125;"</span> <span class="attr">var</span>=<span class="string">"item"</span> <span class="attr">varStatus</span>=<span class="string">"s"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"itemsList[$&#123;s.index&#125;].name"</span> <span class="attr">value</span>=<span class="string">"$&#123;item.name&#125;"</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"itemsList[$&#123;s.index&#125;].price"</span> <span class="attr">value</span>=<span class="string">"$&#123;item.price&#125;"</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">fmt:formatDate</span> <span class="attr">value</span>=<span class="string">"$&#123;item.createtime&#125;"</span> <span class="attr">pattern</span>=<span class="string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;item.detail &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/items/editItems.action?id=$&#123;item.id&#125;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在controller中加入如下两个方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量修改商品查询</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/editItemsList"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">editItemsList</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//调用servie来查询商品列表</span></span><br><span class="line">       List&lt;ItemsCustom&gt; itemsList=itemsService.findItemsList(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">       ModelAndView modelAndView=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">       modelAndView.addObject(<span class="string">"itemsList"</span>,itemsList);</span><br><span class="line">       <span class="comment">//指定逻辑视图名itemsList.jsp</span></span><br><span class="line">       modelAndView.setViewName(<span class="string">"editItemsList"</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> modelAndView;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//批量修改商品的提交</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/editItemsListSubmit"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">editItemsListSubmit</span><span class="params">(ItemsQueryVo itemsQueryVo)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>在xml页面中的name属性值的定义是很重要的，因为在我们提交表单后该数据是会绑定到后台中的方法参数中的，这里我们使用<code>itemsList[${s.index}].name</code>作为name的属性值，所以我们在controller的submit方法中添加了一个ItemsQueryVo的参数，若想完成绑定则需要在ItemsQueryVo中定义一个itemsList的属性，如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemsQueryVo</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//商品信息</span></span><br><span class="line">	<span class="keyword">private</span> ItemsCustom itemsCustom;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义一个list</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;ItemsCustom&gt; itemsList;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;ItemsCustom&gt; <span class="title">getItemsList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> itemsList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItemsList</span><span class="params">(List&lt;ItemsCustom&gt; itemsList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.itemsList = itemsList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ItemsCustom <span class="title">getItemsCustom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> itemsCustom;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItemsCustom</span><span class="params">(ItemsCustom itemsCustom)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.itemsCustom = itemsCustom;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注释:<br><code>itemsList:</code>controller方法形参包装类型中list的属性名。<br><code>itemsList[0]或itemsList[1]...</code>的[]中是序号，从0开始。<br><code>itemsList[].name:</code>中name就是controller方法形参包装类型中list中pojo的属性名。(有点绕口)  </p>
<h2 id="3-商品图片的上传"><a href="#3-商品图片的上传" class="headerlink" title="3.商品图片的上传"></a>3.商品图片的上传</h2><p>需求:在商品修改页面，增加图片上传的功能。  </p>
<p>操作流程:用户进入商品修改页面,上传图片,点击提交（提交的是图片和商品信息,再次进入修改页面，图片在商品修改页面展示。  </p>
<h3 id="3-1图片存储问题"><a href="#3-1图片存储问题" class="headerlink" title="3.1图片存储问题"></a>3.1图片存储问题</h3><p>切记：不要把图片上传到工程目录 ，不方便进行工程维护。实际电商项目中使用专门图片服务器(http，比如apache、tomcat)。本教程使用图片虚拟目录，通过虚拟目录访问硬盘上存储的图片目录。  </p>
<p>我用的是开发工具为IDEA，虚拟目录的设置为,1.打开tomcat的设置:<br><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.38.02.png" alt="">  </p>
<p>2.点击External Source:<br><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.39.28.png" alt="">  </p>
<p>3.进入到如下页面:<br><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%883.39.43.png" alt="">  </p>
<p>选择硬盘上的一个路径作为虚拟目录的位置，以后上传的图片都会放在此路径上。并在Application context中添加一个在服务器上访问的路径别名，我这里设置的为<code>/pic</code>。若想访问该目录下的图片，则在浏览器网站上输入:<code>http://localhost:8080/pic/图片名称</code>，(不需要写项目名称)，即可在浏览器中成功访问到该图片。  </p>
<p><strong>注意:</strong>图片目录中尽量进行目录分级存储，提高访问速度（提交i/o）</p>
<h3 id="3-2配置图片上传解析器"><a href="#3-2配置图片上传解析器" class="headerlink" title="3.2配置图片上传解析器"></a>3.2配置图片上传解析器</h3><p>springmvc使用commons-fileupload进行图片上传。  </p>
<p>需要导入的jar包为:commons-fileupload-1.2.2.jar和依赖包commons-io-2.4.jar。  </p>
<p>然后在springmvc中配置图片上传解析器:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文件上传</span><br><span class="line">   CommonsMultipartResolver依赖我们传入的fileupload jar包--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span><br><span class="line">         <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 设置上传文件的最大尺寸为5MB --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">value</span>&gt;</span>5242880<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-3编写上传图片的页面"><a href="#3-3编写上传图片的页面" class="headerlink" title="3.3编写上传图片的页面"></a>3.3编写上传图片的页面</h3><p>在editItem.jsp中添加图片的文件表单项:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">td</span>&gt;</span>商品图片<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;itemsCustom.pic&#125;!=null"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/pic/$&#123;itemsCustom.pic&#125;"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"pictureFile"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>另外涉及到文件表单项的地方需要在form标签中添加<code>enctype=&quot;multipart/form-data&quot;</code>的属性。  </p>
<h3 id="3-4编写controller方法"><a href="#3-4编写controller方法" class="headerlink" title="3.4编写controller方法"></a>3.4编写controller方法</h3><p>修改edititemSubmit方法，添加参数图片进行页面的图片信息与参数的绑定:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/editItemSubmit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">editItemSubmit</span><span class="params">(Model model,Integer id,</span><br><span class="line">                                 @Validated(value = &#123;ValidGroup1.class&#125;)</span> @<span class="title">ModelAttribute</span><span class="params">(value = <span class="string">"itemsCustom"</span>)</span> ItemsCustom itemsCustom,</span><br><span class="line">                                 BindingResult bindingResult,</span><br><span class="line">                                 <span class="comment">//上传图片</span></span><br><span class="line">                                 MultipartFile pictureFile</span><br><span class="line">                                 ) <span class="keyword">throws</span> Exception</span><br><span class="line">    </span>&#123;</span><br><span class="line">     <span class="comment">//进行数据回显</span></span><br><span class="line">        model.addAttribute(<span class="string">"id"</span>,id);</span><br><span class="line"><span class="comment">//        model.addAttribute("item",itemsCustom);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行图片的上传</span></span><br><span class="line">        <span class="keyword">if</span> (pictureFile!=<span class="keyword">null</span>&amp;&amp;pictureFile.getOriginalFilename()!=<span class="keyword">null</span>&amp;&amp;pictureFile.getOriginalFilename().length()&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//图片上传成功后，将图片的地址写到数据库</span></span><br><span class="line">            String filePath=<span class="string">"/Users/codingBoy/Pictures/"</span>;<span class="comment">//它的值要同你设置虚拟目录时涉及的目录路径一致，</span></span><br><span class="line">            String originalFilename=pictureFile.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">            String newFileName= UUID.randomUUID()+originalFilename.substring(originalFilename.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//新文件</span></span><br><span class="line">            File file=<span class="keyword">new</span> File(filePath+newFileName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将内存中的文件写入磁盘</span></span><br><span class="line">            pictureFile.transferTo(file);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//图片上传成功</span></span><br><span class="line">            itemsCustom.setPic(newFileName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        itemsService.updateItems(id,itemsCustom);</span><br><span class="line">        <span class="comment">//请求转发</span></span><br><span class="line"><span class="comment">//        return "forward:queryItems.action";</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"editItem"</span>;</span><br><span class="line">        <span class="comment">//重定向</span></span><br><span class="line">        <span class="comment">//return "redirect:queryItems.action";</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>然后运行程序，在修改商品信息的页面上传图片，成功上传后便可在你设置的虚拟目录中找到你上传的图片。  </p>
<h2 id="4-json数据的交互"><a href="#4-json数据的交互" class="headerlink" title="4.json数据的交互"></a>4.json数据的交互</h2><p>需求:json数据格式是比较简单容易理解，json数据格式常用于远程接口传输，http传输json数据，非常方便页面进行提交/请求结果解析，对json数据的解析。</p>
<h3 id="4-1springmvc解析json需要加入的json解析包"><a href="#4-1springmvc解析json需要加入的json解析包" class="headerlink" title="4.1springmvc解析json需要加入的json解析包"></a>4.1springmvc解析json需要加入的json解析包</h3><p>Springmvc默认用MappingJacksonHttpMessageConverter对json数据进行转换，需要加入jackson的包:jackson-core-sal-1.9.11.jar和jackson-mapper-asl-1.9.11.jar。  </p>
<h3 id="4-2在处理器适配器中加入MappingJacksonHttpMessageConverter配置"><a href="#4-2在处理器适配器中加入MappingJacksonHttpMessageConverter配置" class="headerlink" title="4.2在处理器适配器中加入MappingJacksonHttpMessageConverter配置"></a>4.2在处理器适配器中加入MappingJacksonHttpMessageConverter配置</h3><p>在springmvc的处理器适配器的配置中加入如下配置信息:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--加入json数据的消息转换器</span><br><span class="line">      MappingJacksonHttpMessageConverter依赖jackson的两个jar包--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverters"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-3-RequestBody和-ResponseBody注解"><a href="#4-3-RequestBody和-ResponseBody注解" class="headerlink" title="4.3@RequestBody和@ResponseBody注解"></a>4.3@RequestBody和@ResponseBody注解</h3><p>@RequestBody:将请求的json数据转成java对象。<br>@ResponseBody:将java对象转成json数据输出。  </p>
<p>图解:<img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.02.01.png" alt="">  </p>
<h3 id="4-4测试1-请求的是json数据，响应的也是json数据"><a href="#4-4测试1-请求的是json数据，响应的也是json数据" class="headerlink" title="4.4测试1:请求的是json数据，响应的也是json数据"></a>4.4测试1:请求的是json数据，响应的也是json数据</h3><p>在controller包下写一个json测试类的controller叫jsonTest.java，代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonTest</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求的json响应json，请求商品信息(该信息为json格式，在页面中通过ajax向写入用户请求的json信息，需要加入@RequestBody注解)，商品信息用json格式输出商品信息(请求的url实际返回的是itemsCustom对象，但由于使用了@ResponseBody就将返回的pojo对象转换成了json格式的数据)</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/requestJson"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">ItemsCustom <span class="title">requestJson</span><span class="params">(@RequestBody ItemsCustom itemsCustom)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> itemsCustom;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在web包下创建一个请求数据的页面jsonTest.jsp,代码如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>json测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/js/jquery-1.4.4.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line"></span><br><span class="line"><span class="comment">//请求json响应json</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestJson</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$.ajax(&#123;</span><br><span class="line">		url:<span class="string">"$&#123;pageContext.request.contextPath &#125;/requestJson.action"</span>,</span><br><span class="line">		type:<span class="string">"post"</span>,</span><br><span class="line">		contentType:<span class="string">"application/json;charset=utf-8"</span>,</span><br><span class="line">		<span class="comment">//请求json数据,使用json表示商品信息</span></span><br><span class="line">		data:<span class="string">'&#123;"name":"手机","price":1999&#125;'</span>,</span><br><span class="line">		success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">			</span><br><span class="line">			alert(data.name);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"请求json响应json"</span> <span class="attr">onclick</span>=<span class="string">"requestJson()"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"请求key/value响应json"</span> <span class="attr">onclick</span>=<span class="string">"responseJson()"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试追踪，在浏览器中输入:<code>http://localhost:8080/SpringMvcMybatis/jsonTest.jsp</code>直接访问改页面，点击<code>请求json响应json</code>按钮，通过抓包的方式，我们看到服务器上放回的信息为:<img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.16.17.png" alt=""></p>
<h3 id="4-5测试2-请求key-value数据，响应的json数据"><a href="#4-5测试2-请求key-value数据，响应的json数据" class="headerlink" title="4.5测试2:请求key/value数据，响应的json数据"></a>4.5测试2:请求key/value数据，响应的json数据</h3><p>在jsonTest.java中加入方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求key/value(在页面中通过ajax写入用户想要请求的key/value信息，不需要加@RequestBody注解)，响应json(由于action返回的是itemsCustom对象，所以需要加入@ResponseBody注解将pojo对象转换为json格式响应给用户)</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/responseJson"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">ItemsCustom <span class="title">responseJson</span><span class="params">(ItemsCustom itemsCustom)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> itemsCustom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在页面中加入如下代码:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求key/value响应json</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">responseJson</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">	$.ajax(&#123;</span><br><span class="line">		url:<span class="string">"$&#123;pageContext.request.contextPath &#125;/responseJson.action"</span>,</span><br><span class="line">		type:<span class="string">"post"</span>,</span><br><span class="line">		<span class="comment">//contentType:"application/json;charset=utf-8",</span></span><br><span class="line">		<span class="comment">//请求key/value数据</span></span><br><span class="line">		data:<span class="string">"name=手机&amp;price=1999"</span>,</span><br><span class="line">		success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">			</span><br><span class="line">			alert(data.name);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试追踪，在浏览器中输入网址，点击<code>请求key/value响应json</code>按钮，通过抓包的方式我们发现丛服务器上返回过来的信息为:<img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.20.04.png" alt="">  </p>
<p>可以看到，我们请求的是key/value数据，而服务器返回的信息是json格式的数据。  </p>
<h3 id="4-6小结"><a href="#4-6小结" class="headerlink" title="4.6小结"></a>4.6小结</h3><p>如果前端处理没有特殊要求建议使用第二种，请求key/value，响应json，方便客户端解析请求结果。  </p>
<h2 id="5validation校验-了解"><a href="#5validation校验-了解" class="headerlink" title="5validation校验(了解)"></a>5validation校验(了解)</h2><p>对前端的校验大多数通过js在页面校验，这种方法比较简单，如果对安全性考虑，还要在后台校验。  </p>
<p>springmvc使用JSR-303（javaEE6规范的一部分）校验规范，springmvc使用的是Hibernate Validator（和Hibernate的ORM无关）。  </p>
<h3 id="5-1加入Hibernate-Validator的jar"><a href="#5-1加入Hibernate-Validator的jar" class="headerlink" title="5.1加入Hibernate Validator的jar"></a>5.1加入Hibernate Validator的jar</h3><p><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.23.53.png" alt="">  </p>
<h3 id="5-2在处理器适配器中配置校验器"><a href="#5-2在处理器适配器中配置校验器" class="headerlink" title="5.2在处理器适配器中配置校验器"></a>5.2在处理器适配器中配置校验器</h3><p>在springmvc.xml中的自定义webBinder标签中加入如下标签:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validator"</span> <span class="attr">ref</span>=<span class="string">"validator"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里引入了一个validator，所以我们需要在springmvc.xml中还需要加入validator的配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"validator"</span></span><br><span class="line">          <span class="attr">class</span>=<span class="string">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"providerClass"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.validator.HibernateValidator"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果不指定则默认使用classpath下的ValidationMessages.properties --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationMessageSource"</span> <span class="attr">ref</span>=<span class="string">"messageSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 校验错误信息配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span></span><br><span class="line">          <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basenames"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>CustomValidationMessages<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fileEncodings"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheSeconds"</span> <span class="attr">value</span>=<span class="string">"120"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在src包下创建一个CustomValidationMessages.properties文件，内容为:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#校验提示信息:items.name.length.error要写在java代码中</span><br><span class="line">items.name.length.error=商品名称的长度请限制在1到30个字符</span><br><span class="line">items.createtime.is.notnull=请输入商品的生产日期</span><br></pre></td></tr></table></figure></p>
<h3 id="5-3校验规则"><a href="#5-3校验规则" class="headerlink" title="5.3校验规则"></a>5.3校验规则</h3><p>需求:商品信息提交时校验 ，商品生产日期不能为空，商品名称长度在1到30字符之间。  </p>
<p>另外首先需要知道的是规则应该在pojo对象的相应属性上规定。</p>
<p>修改pojo的Items.java内容如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Items</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Size</span>(min = <span class="number">1</span>,max = <span class="number">30</span>,message = <span class="string">"&#123;items.name.length.error&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">    <span class="meta">@NotNull</span>(message=<span class="string">"&#123;items.createtime.is.notnull&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createtime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String detail;</span><br><span class="line">&#125;</span><br><span class="line">省略了相应的setter和getter方法。</span><br></pre></td></tr></table></figure></p>
<p>通过上面的操作我们定义了校验的规则，那么当违反了上述规则后我们该如何捕获错误呢?需要修改controller方法，在要校验的pojo前边加上@Validated注解，在editItemSubmit()方法中添加如下内容:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//商品提交页面</span></span><br><span class="line">    <span class="comment">//itemsQueryVo是包装类型的pojo</span></span><br><span class="line">    <span class="comment">//在@Validated中定义使用ValidGroup1组下边的校验</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/editItemSubmit"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">editItemSubmit</span><span class="params">(Model model,Integer id,</span><br><span class="line">                                 @Validated @ModelAttribute(value = <span class="string">"itemsCustom"</span>)</span> ItemsCustom itemsCustom,</span><br><span class="line">                                 BindingResult bindingResult,</span><br><span class="line">                                 <span class="comment">//上传图片</span></span><br><span class="line">                                 MultipartFile pictureFile</span><br><span class="line">                                 ) <span class="keyword">throws</span> Exception</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">//输出校验错误信息</span></span><br><span class="line">        <span class="comment">//如果参数绑定时出错</span></span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//获取错误</span></span><br><span class="line">            List&lt;ObjectError&gt; errors=bindingResult.getAllErrors();</span><br><span class="line"></span><br><span class="line">            model.addAttribute(<span class="string">"errors"</span>,errors);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (ObjectError error:errors)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//输出错误信息</span></span><br><span class="line">                System.out.println(error.getDefaultMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果校验错误，仍然回到商品修改页面</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"editItem"</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后是在页面editItem.jsp中展示错误:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--错误信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;errors&#125;"</span> <span class="attr">var</span>=<span class="string">"error"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>$&#123;error.defaultMessage&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>运行程序，在修改商品信息的页面当我们没有输入日起或是将商品名称超过了20个字符时便不能完成页面的跳转而是在该修改页面显示错误信息。  </p>
<p>以上我们便通过Validation完成了校验。下面我们来谈谈分组校验:针对不同的controller方法通过分组校验达到个性化校验的目的。</p>
<h3 id="5-4分组校验"><a href="#5-4分组校验" class="headerlink" title="5.4分组校验"></a>5.4分组校验</h3><p>需求:修改商品修改功能，只校验生产日期不能为空。  </p>
<p>第一步:创建分组接口,创建一个ValidGroup1.java接口:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ValidGroup1</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//接口不定义方法，相当于接口就是个类型，只标识哪些校验规则属于该ValidGroup1分组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二步:定义校验规则属于哪个校验分组:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过groups指定此校验属于哪个分组，当然可以指定多个分组</span></span><br><span class="line">   <span class="meta">@NotNull</span>(message=<span class="string">"&#123;items.createtime.is.notnull&#125;"</span>,groups = &#123;ValidGroup1.class&#125;)</span><br><span class="line">   <span class="keyword">private</span> Date createtime;</span><br></pre></td></tr></table></figure></p>
<p>而属性name的校验规则没有添加groups属性。  </p>
<p>第三步:在controller方法定义使用校验的分组。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">editItemSubmit</span><span class="params">(Model model,Integer id,</span><br><span class="line">                              @Validated(value = &#123;ValidGroup1.class&#125;)</span> @<span class="title">ModelAttribute</span><span class="params">(value = <span class="string">"itemsCustom"</span>)</span> ItemsCustom itemsCustom,</span><br><span class="line">                              BindingResult bindingResult,</span><br><span class="line">                              <span class="comment">//上传图片</span></span><br><span class="line">                              MultipartFile pictureFile</span><br><span class="line">                              ) <span class="keyword">throws</span> Exception</span><br><span class="line"> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时运行程序，在编辑商品信息页面中只会进行日期是否为空的校验，而不能进行商品名称信息的校验。因为在pojo的name属性中我们没有指定该校验规则属于哪个分组，所以在controller的方法中就无法定义使用该校验规则的分组，也就无法进行商品名称的校验。  </p>
<h2 id="6-统一异常处理"><a href="#6-统一异常处理" class="headerlink" title="6.统一异常处理"></a>6.统一异常处理</h2><p>需求:一般项目中都需要作异常处理，基于系统架构的设计考虑，使用统一的异常处理方法。  </p>
<p>系统中异常类型有哪些？  </p>
<p>包括预期可能发生的异常、运行时异常（RuntimeException），运行时异常不是预期会发生的。  </p>
<p>针对预期可能发生的异常，在代码手动处理异常可以try/catch捕获，可以向上抛出。  </p>
<p>针对运行时异常，只能通过规范代码质量、在系统测试时详细测试等排除运行时异常。</p>
<h3 id="6-1统一异常处理解决方案"><a href="#6-1统一异常处理解决方案" class="headerlink" title="6.1统一异常处理解决方案"></a>6.1统一异常处理解决方案</h3><h4 id="6-1-2自定义系统异常类"><a href="#6-1-2自定义系统异常类" class="headerlink" title="6.1.2自定义系统异常类"></a>6.1.2自定义系统异常类</h4><p>针对预期可能发生的异常，定义很多异常类型，这些异常类型通常继承于Exception。这里定义一个系统自定义异常类CustomException.java，用于测试:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常信息</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.message=message;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="6-1-2异常处理"><a href="#6-1-2异常处理" class="headerlink" title="6.1.2异常处理"></a>6.1.2异常处理</h4><p>要在一个统一异常处理的类中要处理系统抛出的所有异常，根据异常类型来处理。</p>
<p>统一异常处理的类是什么？</p>
<p>前端控制器DispatcherServlet在进行HandlerMapping、调用HandlerAdapter执行Handler过程中，如果遇到异常，都会调用这个统一异常处理类。当然该类只有实现HandlerExceptionResolver接口才能叫统一异常处理类。  </p>
<h5 id="6-1-2-1定义统一异常处理器类"><a href="#6-1-2-1定义统一异常处理器类" class="headerlink" title="6.1.2.1定义统一异常处理器类"></a>6.1.2.1定义统一异常处理器类</h5><p>创建一个CustomExceptionResolver.java文件并实现HandlerExceptionResolver接口，代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//前端控制器DispatcherServlet在进行HandlerMapping、</span></span><br><span class="line">    <span class="comment">// 调用HandlerAdapter执行Handler过程中，如果遇到异常就会执行此方法</span></span><br><span class="line">    <span class="comment">//参数中的handler是最终要执行的Handler，它的真实身份是HandlerMethod</span></span><br><span class="line">    <span class="comment">//ex就是接受到的异常信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest request,</span><br><span class="line">                                         HttpServletResponse response,</span><br><span class="line">                                         Object handler, Exception ex)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="6-1-2-2配置统一异常处理器"><a href="#6-1-2-2配置统一异常处理器" class="headerlink" title="6.1.2.2配置统一异常处理器"></a>6.1.2.2配置统一异常处理器</h5><p>在springmvc.xml文件中加入统一异常处理器的配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义统一异常处理器--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"exception.CustomExceptionResolver"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="6-1-2-3统一异常处理逻辑"><a href="#6-1-2-3统一异常处理逻辑" class="headerlink" title="6.1.2.3统一异常处理逻辑"></a>6.1.2.3统一异常处理逻辑</h5><p>根据不同的异常类型进行异常处理。</p>
<p>系统自定义的异常类是CustomException ，在controller方法中、service方法中手动抛出此类异常。</p>
<p>针对系统自定义的CustomException异常，就可以直接从异常类中获取异常信息，将异常处理在错误页面展示。<br>针对非CustomException异常，对这类重新构造成一个CustomException，异常信息为“未知错误”，此类错误需要在系统测试阶段去排除。</p>
<p>在统一异常处理器CustomExceptionResolver中实现上边的逻辑。在CustomExceptionResolver.java中加入如下内容实现上述逻辑:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出异常</span></span><br><span class="line">     ex.printStackTrace();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">//统一异常处理代码</span></span><br><span class="line">     <span class="comment">//针对系统自定义的CustomException异常，就可以直接从一场中获取一场信息，将异常处理在错误页面展示</span></span><br><span class="line">     <span class="comment">//异常信息</span></span><br><span class="line">     String message=<span class="keyword">null</span>;</span><br><span class="line">     CustomException customException=<span class="keyword">null</span>;</span><br><span class="line">     <span class="comment">//如果ex是系统自定义的异常，我们就直接取出异常信息</span></span><br><span class="line">     <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> CustomException)</span><br><span class="line">     &#123;</span><br><span class="line">         customException= (CustomException) ex;</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         customException=<span class="keyword">new</span> CustomException(<span class="string">"未知错误"</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//错误信息</span></span><br><span class="line">     message=customException.getMessage();</span><br><span class="line"></span><br><span class="line">     request.setAttribute(<span class="string">"message"</span>,message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//转向到错误页面</span></span><br><span class="line">         request.getRequestDispatcher(<span class="string">"/WEB-INF/jsp/error.jsp"</span>).forward(request,response);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (ServletException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="6-1-2-4测试抛出异常由统一异常处理器捕获"><a href="#6-1-2-4测试抛出异常由统一异常处理器捕获" class="headerlink" title="6.1.2.4测试抛出异常由统一异常处理器捕获"></a>6.1.2.4测试抛出异常由统一异常处理器捕获</h5><p>可以在controller方法、service方法、dao实现类中抛出异常，要求dao、service、controller遇到异常全部向上抛出异常，方法向 上抛出异常throws Exception。</p>
<p>在ItemsServiceImpl.java的findItemsById方法中添加如下内容:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ItemsCustom <span class="title">findItemsById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Items items=itemsMapper.selectByPrimaryKey(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果查询的商品信息为空，抛出系统自定义的异常</span></span><br><span class="line">    <span class="keyword">if</span> (items==<span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">"修改商品信息不存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在这里以后随着需求的变化，需要查询商品的其它相关信息，返回到controller</span></span><br><span class="line">    <span class="comment">//所以这个时候用到扩展类更好，如下</span></span><br><span class="line">    ItemsCustom itemsCustom=<span class="keyword">new</span> ItemsCustom();</span><br><span class="line">    <span class="comment">//将items的属性拷贝到itemsCustom</span></span><br><span class="line">    BeanUtils.copyProperties(items,itemsCustom);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> itemsCustom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>图解:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%884.56.44.png" alt="">  </p>
<p>测试:运行程序，在流浪器中我们输入<code>http://localhost:8080/SpringMvcMybatis/items/editItems.action?id=111</code>，由于没有哪个商品信息的id为111，所以出现异常，一旦出现异常，系统会立马走向统一异常处理器，执行统一异常处理器中的程序。</p>
<h2 id="7-RESTful支持"><a href="#7-RESTful支持" class="headerlink" title="7.RESTful支持"></a>7.RESTful支持</h2><h3 id="7-1什么RESTful"><a href="#7-1什么RESTful" class="headerlink" title="7.1什么RESTful"></a>7.1什么RESTful</h3><p>RESTful是一种软件开发理念，RESTful对http进行非常好的诠释。RESTful即Representational State Transfer的缩写。关于RESTful我建议大家去看看这篇文章<a href="http://www.ruanyifeng.com/blog/2011/09/restful.html" target="_blank" rel="external">理解RESTful架构–阮一峰的网络日志</a></p>
<h3 id="7-2url的RESTful实现"><a href="#7-2url的RESTful实现" class="headerlink" title="7.2url的RESTful实现"></a>7.2url的RESTful实现</h3><p>非RESTful的http的url:<code>http://localhost:8080/items/editItems.action?id=1&amp;....</code>  </p>
<p>RESTful的url是简洁的:<code>http:// localhost:8080/items/editItems/1</code>  </p>
<p>参数通过url传递，rest接口返回json数据</p>
<h4 id="7-2-1需求"><a href="#7-2-1需求" class="headerlink" title="7.2.1需求"></a>7.2.1需求</h4><p>根据id查看商品信息，商品信息查看的连接使用RESTful方式实现，商品信息以json返回。</p>
<h4 id="7-2-2第一步更改DispatcherServlet配置"><a href="#7-2-2第一步更改DispatcherServlet配置" class="headerlink" title="7.2.2第一步更改DispatcherServlet配置"></a>7.2.2第一步更改DispatcherServlet配置</h4><p>在web.xml中再添加一个前端控制器:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--RESTful的配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc_rest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载springmvc配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置文件的地址</span><br><span class="line">        如果不配置contextConfigLocation，默认查找的配置文件名称是classpath下的:servlet名称+"-servlet.xml"即springmvc-servlet.xml--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:config/spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc_rest<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可以配置/：此工程所有的请求全部由springmvc解析，此种方式可以实现RESTful方式，需要特殊处理对静态文件的解析不能由springmvc解析</span><br><span class="line">    可以配置*.do或者*.action,所有请求的url扩展名为.do或.action由springmvc解析，此中方法常用</span><br><span class="line">    不可以配置/*,如果配置/*,返回jsp也由springmvc解析，这是不对的--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--reft方式配置为/--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="7-2-3第二步参数通过url传递"><a href="#7-2-3第二步参数通过url传递" class="headerlink" title="7.2.3第二步参数通过url传递"></a>7.2.3第二步参数通过url传递</h4><p>在controller中添加一个方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更具商品id查看商品信息rest接口</span></span><br><span class="line">   <span class="comment">//@requestMapping中指定restful方式的url中的参数，参数需要用&#123;&#125;包起来</span></span><br><span class="line">   <span class="comment">//@PathVariable将url中的参数和形参进行绑定</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/viewItems/&#123;id&#125;"</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">ItemsCustom <span class="title">viewItems</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) <span class="keyword">throws</span> Exception</span><br><span class="line">   </span>&#123;</span><br><span class="line">       <span class="comment">//调用service查询商品的信息</span></span><br><span class="line">       ItemsCustom itemsCustom=itemsService.findItemsById(id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> itemsCustom;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>此时我们便可以在浏览器中输入<code>http://localhost:8080/SpringMvcMybatis/items/viewItems/1</code>来查看商品信息。  </p>
<p>但是此时会有个bug，我们在web.xml中将访问所有路径的方式设置为:<code>&lt;url-pattern&gt;/&lt;/url-pattern&gt;</code>即访问只要是该路径下的资源时都会经过前端控制器，这是不对的。当我们访问web包下的静态资源时也会经过前端控制器由springmvc解析，这当然是不正确的。所以我们需要设置静态资源的解析，在springmvc.xml中添加如下配置信息:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>表示访问web/js/包下的静态资源时不会被前端控制器拦截也就不会被springmvc.xml解析。此时便可以正常访问静态资源。</p>
<h2 id="8-springmvc拦截器"><a href="#8-springmvc拦截器" class="headerlink" title="8.springmvc拦截器"></a>8.springmvc拦截器</h2><h3 id="8-1拦截器的应用场合"><a href="#8-1拦截器的应用场合" class="headerlink" title="8.1拦截器的应用场合"></a>8.1拦截器的应用场合</h3><p>用户请求到DispatherServlet中，DispatherServlet调用HandlerMapping查找Handler，HandlerMapping返回一个拦截的链儿（多个拦截），springmvc中的拦截器是通过HandlerMapping发起的。  </p>
<p>在企业开发，使用拦截器实现用户认证（用户登陆后进行身份校验拦截），用户权限拦截。  </p>
<h3 id="8-2springmvc拦截器方法"><a href="#8-2springmvc拦截器方法" class="headerlink" title="8.2springmvc拦截器方法"></a>8.2springmvc拦截器方法</h3><p>定义一个拦截器HandlerInterceptor1.java实现HandlerInterceptor接口:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerInterceptor1</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//在执行handler之前来执行的</span></span><br><span class="line">    <span class="comment">//用于用户认证校验、用户权限校验</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		 <span class="comment">//返回false表示进行拦截，不继续执行handler。返回true表示不进行拦截，继续执行handler</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在执行handerl但是返回modelandview之前来执行</span></span><br><span class="line">    <span class="comment">//如果需要向页面提供一些公用的数据或配置一些视图信息，使用此方法实现从modelAndView入手</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response, Object handler,</span><br><span class="line">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行handler之后执行此方法</span></span><br><span class="line">    <span class="comment">//做系统统一异常处理，进行方法执行性能监控，在prehandler中设置一个时间点，在afterCompletion设置一个时间点，两个时间点的差就是执行时长</span></span><br><span class="line">    <span class="comment">//实现系统统一日志记录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span><br><span class="line">                                Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="8-3测试拦截器"><a href="#8-3测试拦截器" class="headerlink" title="8.3测试拦截器"></a>8.3测试拦截器</h3><p>再定义一个拦截器HandlerInterceptor2.java，代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerInterceptor2</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//在执行handler之前来执行的</span></span><br><span class="line">    <span class="comment">//用于用户认证校验、用户权限校验</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"HandlerInterceptor2....postHandle"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回false表示拦截不继续执行handler，返回true表示放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在执行handerl但是返回modelandview之前来执行</span></span><br><span class="line">    <span class="comment">//如果需要向页面提供一些公用的数据或配置一些视图信息，使用此方法实现从modelAndView入手</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response, Object handler,</span><br><span class="line">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"HandlerInterceptor2....postHandler"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行handler之后执行此方法</span></span><br><span class="line">    <span class="comment">//做系统统一异常处理，进行方法执行性能监控，在prehandler中设置一个时间点，在afterCompletion设置一个时间点，两个时间点的差就是执行时长</span></span><br><span class="line">    <span class="comment">//实现系统统一日志记录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span><br><span class="line">                                Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"HandlerInterceptor2....afterCompletion"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="8-3-1配置拦截器"><a href="#8-3-1配置拦截器" class="headerlink" title="8.3.1配置拦截器"></a>8.3.1配置拦截器</h4><p>配置全局的拦截器，DispatcherServlet将配置的全局拦截器加载到所有的HandlerMapping。在springmvc.xml中配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--多个拦截器,顺序执行 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.interceptor.HandlerInterceptor1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.interceptor.HandlerInterceptor2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="8-3-2测试1-拦截器1与2都放行"><a href="#8-3-2测试1-拦截器1与2都放行" class="headerlink" title="8.3.2测试1:拦截器1与2都放行"></a>8.3.2测试1:拦截器1与2都放行</h4><p>测试结果为:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HandlerInterceptor1...preHandle</span><br><span class="line">HandlerInterceptor2...preHandle</span><br><span class="line"></span><br><span class="line">HandlerInterceptor2...postHandle</span><br><span class="line">HandlerInterceptor1...postHandle</span><br><span class="line"></span><br><span class="line">HandlerInterceptor2...afterCompletion</span><br><span class="line">HandlerInterceptor1...afterCompletion</span><br></pre></td></tr></table></figure></p>
<p>总结:执行preHandle是顺序执行。执行postHandle、afterCompletion是倒序执行。  </p>
<h4 id="8-3-3测试2-拦截器1放行，2不放行"><a href="#8-3-3测试2-拦截器1放行，2不放行" class="headerlink" title="8.3.3测试2:拦截器1放行，2不放行"></a>8.3.3测试2:拦截器1放行，2不放行</h4><p>此时访问界面，界面是空白的但是不会出现报错信息,控制台打印测试结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HandlerInterceptor1...preHandle</span><br><span class="line">HandlerInterceptor2...preHandle</span><br><span class="line">HandlerInterceptor1...afterCompletion</span><br></pre></td></tr></table></figure></p>
<p>总结:如果preHandle不放行，postHandle、afterCompletion都不执行。只要有一个拦截器不放行，controller不能执行完成。  </p>
<h4 id="8-3-3测试2-拦截器1和2都不放行"><a href="#8-3-3测试2-拦截器1和2都不放行" class="headerlink" title="8.3.3测试2:拦截器1和2都不放行"></a>8.3.3测试2:拦截器1和2都不放行</h4><p>测试结果:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HandlerInterceptor1...preHandle</span><br></pre></td></tr></table></figure></p>
<p>将这个测试结果和测试2结果进行比较，该测试结果只有拦截器1的preHandle方法执行而2的prehandle方法没有执行；而测试2结果拦截器1和2的preHandle都执行了，说明只有前边的拦截器放行时后面拦截器的preHandle方法才会执行。  </p>
<h3 id="8-4拦截器的应用"><a href="#8-4拦截器的应用" class="headerlink" title="8.4拦截器的应用"></a>8.4拦截器的应用</h3><p>需求:用户访问系统的资源(url)，如果用户没有进行身份认证，进行拦截，系统跳转登陆页面，如果用户已经认证通过，用户可以继续访问系统的资源。  </p>
<h4 id="8-4-1用户登录及退出功能开发"><a href="#8-4-1用户登录及退出功能开发" class="headerlink" title="8.4.1用户登录及退出功能开发"></a>8.4.1用户登录及退出功能开发</h4><p>新建一个controller，LoginController.java,代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户登陆提交方法</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(HttpSession session,String usercode, String password)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">//调用service校验用户帐号和密码的正确性</span></span><br><span class="line">        <span class="comment">//这个东西我们讲shiro的时候再写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果service校验通过，将用户身份记录到session</span></span><br><span class="line">        session.setAttribute(<span class="string">"usercode"</span>,usercode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重定向到商品查询页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/items/queryItems.action"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户退出</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/logout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">(HttpSession session)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">//session失效</span></span><br><span class="line">        session.invalidate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重定向到商品查询页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/items/queryItems.action"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="8-4-2用户身份认证校验拦截器"><a href="#8-4-2用户身份认证校验拦截器" class="headerlink" title="8.4.2用户身份认证校验拦截器"></a>8.4.2用户身份认证校验拦截器</h4><p>拦截实现的思路:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-19%20%E4%B8%8B%E5%8D%885.29.43.png" alt=""></p>
<h4 id="8-4-3拦截器的编写"><a href="#8-4-3拦截器的编写" class="headerlink" title="8.4.3拦截器的编写"></a>8.4.3拦截器的编写</h4><p>新建一个拦截器LoginInterceptor.java,代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//在执行handler之前来执行的</span></span><br><span class="line">    <span class="comment">//用于用户认证校验、用户权限校验</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String url=request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否是公开地址</span></span><br><span class="line">        <span class="comment">//世纪开发中需要将公开地址配置在配置文件中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (url.indexOf(<span class="string">"login.action"</span>)&gt;=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//如果是公开地址则放行</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断用户身份在session中是否存在</span></span><br><span class="line">        HttpSession session=request.getSession();</span><br><span class="line">        String usercode= (String) session.getAttribute(<span class="string">"usercode"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果用户身份在session中存在则放行</span></span><br><span class="line">        <span class="keyword">if</span> (usercode!=<span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行到这里就拦截，跳转到登陆页面，用户进行登陆</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">"/WEB-INF/jsp/login.jsp"</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//在执行handerl但是返回modelandview之前来执行</span></span><br><span class="line">    <span class="comment">//如果需要向页面提供一些公用的数据或配置一些视图信息，使用此方法实现从modelAndView入手</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response, Object handler,</span><br><span class="line">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"HandlerInterceptor1....postHandle"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行handler之后执行此方法</span></span><br><span class="line">    <span class="comment">//做系统统一异常处理，进行方法执行性能监控，在prehandler中设置一个时间点，在afterCompletion设置一个时间点，两个时间点的差就是执行时长</span></span><br><span class="line">    <span class="comment">//实现系统统一日志记录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span><br><span class="line">                                Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"HandlerInterceptor1....afterCompletion"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后在springmvc.xml中配置该拦截器，需要注视掉我们之前配置的拦截器:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--拦截器 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--多个拦截器,顺序执行 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;mvc:interceptor&gt;--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--&lt;mvc:mapping path="/**"/&gt;--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--&lt;bean class="controller.interceptor.HandlerInterceptor1"&gt;&lt;/bean&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;/mvc:interceptor&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;mvc:interceptor&gt;--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--&lt;mvc:mapping path="/**"/&gt;--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--&lt;bean class="controller.interceptor.HandlerInterceptor2"&gt;&lt;/bean&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;/mvc:interceptor&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--/**可以拦截路径不管有多少层--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"controller.interceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后运行程序，当用户访问的不是公开url且用户没有登录时，该拦截器就会将用户的请求拦截并使用户跳转到登录页面进行登录。</p>
<h2 id="9-联系"><a href="#9-联系" class="headerlink" title="9.联系"></a>9.联系</h2><p>  If you have some questions after you see this article,you can tell your doubts in the comments area or you can find some info by  clicking these links.</p>
<ul>
<li><p><a href="http://codingxiaxw.cn">Blog@codingXiaxw’s blog</a></p>
</li>
<li><p><a href="http://weibo.com/u/5023661572?from=hissimilar_home&amp;refer_flag=1005050003_" target="_blank" rel="external">Weibo@codingXiaxw</a></p>
</li>
<li><p><a href="http://www.zhihu.com/people/e9f78fa34b8002652811ac348da3f671" target="_blank" rel="external">Zhihu@codingXiaxw</a>  </p>
</li>
<li><a href="https://github.com/codingXiaxw" target="_blank" rel="external">Github@codingXiaxw</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://od2xrf8gr.bkt.clouddn.com/61591357B4886B1E1F949CBB68322C34.jpg" alt="codingXiaxw WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/SSM/" rel="tag">#SSM</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/15/45-smm快速入门/" rel="next" title="一个案例带你快速入门SSM开发">
                <i class="fa fa-chevron-left"></i> 一个案例带你快速入门SSM开发
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/20/47-first-Shiro/" rel="prev" title="初识Shiro">
                初识Shiro <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/19/46-ssm高级开发/"
           data-title="SSM注解开发的高级知识讲解" data-url="http://codingxiaxw.cn/2016/11/19/46-ssm高级开发/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://od2xrf8gr.bkt.clouddn.com/%E5%A4%B4%E5%83%8F.jpg"
               alt="codingXiaxw" />
          <p class="site-author-name" itemprop="name">codingXiaxw</p>
          <p class="site-description motion-element" itemprop="description">Life is short,just coding.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">61</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/codingXiaxw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5023661572?from=hissimilar_home&refer_flag=1005050003_" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com//people/e9f78fa34b8002652811ac348da3f671" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-数据回显"><span class="nav-number">1.</span> <span class="nav-text">1.数据回显</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-将页面信息绑定到参数集合类型中"><span class="nav-number">2.</span> <span class="nav-text">2.将页面信息绑定到参数集合类型中</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1将页面信息绑定到数组参数中"><span class="nav-number">2.1.</span> <span class="nav-text">2.1将页面信息绑定到数组参数中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2绑定页面信息到List中"><span class="nav-number">2.2.</span> <span class="nav-text">2.2绑定页面信息到List中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-商品图片的上传"><span class="nav-number">3.</span> <span class="nav-text">3.商品图片的上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1图片存储问题"><span class="nav-number">3.1.</span> <span class="nav-text">3.1图片存储问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2配置图片上传解析器"><span class="nav-number">3.2.</span> <span class="nav-text">3.2配置图片上传解析器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3编写上传图片的页面"><span class="nav-number">3.3.</span> <span class="nav-text">3.3编写上传图片的页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4编写controller方法"><span class="nav-number">3.4.</span> <span class="nav-text">3.4编写controller方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-json数据的交互"><span class="nav-number">4.</span> <span class="nav-text">4.json数据的交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1springmvc解析json需要加入的json解析包"><span class="nav-number">4.1.</span> <span class="nav-text">4.1springmvc解析json需要加入的json解析包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2在处理器适配器中加入MappingJacksonHttpMessageConverter配置"><span class="nav-number">4.2.</span> <span class="nav-text">4.2在处理器适配器中加入MappingJacksonHttpMessageConverter配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-RequestBody和-ResponseBody注解"><span class="nav-number">4.3.</span> <span class="nav-text">4.3@RequestBody和@ResponseBody注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4测试1-请求的是json数据，响应的也是json数据"><span class="nav-number">4.4.</span> <span class="nav-text">4.4测试1:请求的是json数据，响应的也是json数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5测试2-请求key-value数据，响应的json数据"><span class="nav-number">4.5.</span> <span class="nav-text">4.5测试2:请求key/value数据，响应的json数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6小结"><span class="nav-number">4.6.</span> <span class="nav-text">4.6小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5validation校验-了解"><span class="nav-number">5.</span> <span class="nav-text">5validation校验(了解)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1加入Hibernate-Validator的jar"><span class="nav-number">5.1.</span> <span class="nav-text">5.1加入Hibernate Validator的jar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2在处理器适配器中配置校验器"><span class="nav-number">5.2.</span> <span class="nav-text">5.2在处理器适配器中配置校验器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3校验规则"><span class="nav-number">5.3.</span> <span class="nav-text">5.3校验规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4分组校验"><span class="nav-number">5.4.</span> <span class="nav-text">5.4分组校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-统一异常处理"><span class="nav-number">6.</span> <span class="nav-text">6.统一异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1统一异常处理解决方案"><span class="nav-number">6.1.</span> <span class="nav-text">6.1统一异常处理解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-2自定义系统异常类"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.2自定义系统异常类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-2异常处理"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-1定义统一异常处理器类"><span class="nav-number">6.1.2.1.</span> <span class="nav-text">6.1.2.1定义统一异常处理器类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-2配置统一异常处理器"><span class="nav-number">6.1.2.2.</span> <span class="nav-text">6.1.2.2配置统一异常处理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-3统一异常处理逻辑"><span class="nav-number">6.1.2.3.</span> <span class="nav-text">6.1.2.3统一异常处理逻辑</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-2-4测试抛出异常由统一异常处理器捕获"><span class="nav-number">6.1.2.4.</span> <span class="nav-text">6.1.2.4测试抛出异常由统一异常处理器捕获</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-RESTful支持"><span class="nav-number">7.</span> <span class="nav-text">7.RESTful支持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1什么RESTful"><span class="nav-number">7.1.</span> <span class="nav-text">7.1什么RESTful</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2url的RESTful实现"><span class="nav-number">7.2.</span> <span class="nav-text">7.2url的RESTful实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-1需求"><span class="nav-number">7.2.1.</span> <span class="nav-text">7.2.1需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-2第一步更改DispatcherServlet配置"><span class="nav-number">7.2.2.</span> <span class="nav-text">7.2.2第一步更改DispatcherServlet配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-3第二步参数通过url传递"><span class="nav-number">7.2.3.</span> <span class="nav-text">7.2.3第二步参数通过url传递</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-springmvc拦截器"><span class="nav-number">8.</span> <span class="nav-text">8.springmvc拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1拦截器的应用场合"><span class="nav-number">8.1.</span> <span class="nav-text">8.1拦截器的应用场合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2springmvc拦截器方法"><span class="nav-number">8.2.</span> <span class="nav-text">8.2springmvc拦截器方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3测试拦截器"><span class="nav-number">8.3.</span> <span class="nav-text">8.3测试拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1配置拦截器"><span class="nav-number">8.3.1.</span> <span class="nav-text">8.3.1配置拦截器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-2测试1-拦截器1与2都放行"><span class="nav-number">8.3.2.</span> <span class="nav-text">8.3.2测试1:拦截器1与2都放行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3测试2-拦截器1放行，2不放行"><span class="nav-number">8.3.3.</span> <span class="nav-text">8.3.3测试2:拦截器1放行，2不放行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3测试2-拦截器1和2都不放行"><span class="nav-number">8.3.4.</span> <span class="nav-text">8.3.3测试2:拦截器1和2都不放行</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4拦截器的应用"><span class="nav-number">8.4.</span> <span class="nav-text">8.4拦截器的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-1用户登录及退出功能开发"><span class="nav-number">8.4.1.</span> <span class="nav-text">8.4.1用户登录及退出功能开发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-2用户身份认证校验拦截器"><span class="nav-number">8.4.2.</span> <span class="nav-text">8.4.2用户身份认证校验拦截器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-3拦截器的编写"><span class="nav-number">8.4.3.</span> <span class="nav-text">8.4.3拦截器的编写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-联系"><span class="nav-number">9.</span> <span class="nav-text">9.联系</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">codingXiaxw</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"codingXiaxw"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("G9m3Gnu7lbpyUM0MJAyJFK9g-gzGzoHsz", "E72YIgigcKXLV4XC5x7GgYDt");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
